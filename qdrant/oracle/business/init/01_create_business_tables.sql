-- 业务数据库初始化脚本
-- 创建业务表结构

-- 活动数据表
CREATE TABLE ACTV_DATA (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ACTIVITY_NAME VARCHAR2(200),
    ACTIVITY_DATE DATE,
    STATUS VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 产品基础信息表
CREATE TABLE B_UT_PROD (
    PROD_ID VARCHAR2(50) PRIMARY KEY,
    PROD_NAME VARCHAR2(200),
    PROD_TYPE VARCHAR2(100),
    PROD_DESC CLOB,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 产品渠道信息表
CREATE TABLE B_UT_PROD_OFER_CHANL (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROD_ID VARCHAR2(50),
    CHANNEL_CODE VARCHAR2(50),
    CHANNEL_NAME VARCHAR2(200),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 产品渠道属性表
CREATE TABLE B_UT_PROD_CHANL_ATTR (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROD_ID VARCHAR2(50),
    CHANNEL_CODE VARCHAR2(50),
    ATTR_NAME VARCHAR2(100),
    ATTR_VALUE VARCHAR2(500),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 批处理作业表
CREATE TABLE BATCH_JOB (
    JOB_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    JOB_NAME VARCHAR2(200),
    JOB_STATUS VARCHAR2(50),
    START_TIME TIMESTAMP,
    END_TIME TIMESTAMP,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 批处理实例表
CREATE TABLE BATCH_JOB_INSTANCE (
    INSTANCE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    JOB_ID NUMBER,
    INSTANCE_STATUS VARCHAR2(50),
    EXECUTION_TIME TIMESTAMP,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 缓存映射表
CREATE TABLE CACHE_MAP (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CACHE_KEY VARCHAR2(500),
    CACHE_VALUE CLOB,
    EXPIRE_TIME TIMESTAMP,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 客户信息表
CREATE TABLE CUSTOMER (
    CUSTOMER_ID VARCHAR2(50) PRIMARY KEY,
    CUSTOMER_NAME VARCHAR2(200),
    CUSTOMER_TYPE VARCHAR2(50),
    REGISTRATION_DATE DATE,
    STATUS VARCHAR2(50),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 产品分类表
CREATE TABLE O_UT_PROD_CAT (
    CAT_ID VARCHAR2(50) PRIMARY KEY,
    CAT_NAME VARCHAR2(200),
    PARENT_CAT_ID VARCHAR2(50),
    CAT_LEVEL NUMBER,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 基金数据表
CREATE TABLE STG_FUNDS_CSV (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FUND_CODE VARCHAR2(50),
    FUND_NAME VARCHAR2(200),
    FUND_TYPE VARCHAR2(100),
    NAV_DATE DATE,
    NAV_VALUE NUMBER(15,4),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX IDX_ACTV_DATA_DATE ON ACTV_DATA(ACTIVITY_DATE);
CREATE INDEX IDX_CUSTOMER_TYPE ON CUSTOMER(CUSTOMER_TYPE);
CREATE INDEX IDX_PROD_TYPE ON B_UT_PROD(PROD_TYPE);
CREATE INDEX IDX_FUND_CODE ON STG_FUNDS_CSV(FUND_CODE);
CREATE INDEX IDX_BATCH_JOB_STATUS ON BATCH_JOB(JOB_STATUS);

-- 插入示例数据
INSERT INTO CUSTOMER VALUES ('CUST001', 'John Doe', 'PREMIUM', DATE '2024-01-01', 'ACTIVE', CURRENT_TIMESTAMP);
INSERT INTO CUSTOMER VALUES ('CUST002', 'Jane Smith', 'STANDARD', DATE '2024-01-02', 'ACTIVE', CURRENT_TIMESTAMP);

INSERT INTO B_UT_PROD VALUES ('PROD001', 'Investment Fund A', 'FUND', 'High-yield investment fund', CURRENT_TIMESTAMP);
INSERT INTO B_UT_PROD VALUES ('PROD002', 'Savings Account', 'ACCOUNT', 'Standard savings account', CURRENT_TIMESTAMP);

INSERT INTO ACTV_DATA VALUES (DEFAULT, 'Customer Onboarding', DATE '2024-01-01', 'COMPLETED', CURRENT_TIMESTAMP);
INSERT INTO ACTV_DATA VALUES (DEFAULT, 'Product Launch', DATE '2024-01-02', 'IN_PROGRESS', CURRENT_TIMESTAMP);

INSERT INTO STG_FUNDS_CSV VALUES (DEFAULT, 'FUND001', 'Global Equity Fund', 'EQUITY', DATE '2024-01-01', 125.50, CURRENT_TIMESTAMP);
INSERT INTO STG_FUNDS_CSV VALUES (DEFAULT, 'FUND002', 'Bond Income Fund', 'BOND', DATE '2024-01-01', 98.75, CURRENT_TIMESTAMP);

COMMIT;

SELECT 'Business database initialization completed!' as status FROM DUAL;
