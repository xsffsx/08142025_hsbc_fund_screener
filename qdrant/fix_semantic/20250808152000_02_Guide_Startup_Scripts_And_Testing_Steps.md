# NL2SQLå¯åŠ¨è„šæœ¬å’Œæµ‹è¯•æ­¥éª¤æŒ‡å—

**åˆ›å»ºæ—¶é—´**: 2025-08-08 15:20:00  
**æ–‡æ¡£ç±»å‹**: Guide  
**ç‰ˆæœ¬**: v1.0  
**ä½œè€…**: Augment Agent

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [å¯åŠ¨è„šæœ¬è¯¦è§£](#å¯åŠ¨è„šæœ¬è¯¦è§£)
- [æµ‹è¯•è„šæœ¬ä½¿ç”¨](#æµ‹è¯•è„šæœ¬ä½¿ç”¨)
- [å¼€å‘å·¥ä½œæµ](#å¼€å‘å·¥ä½œæµ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†NL2SQLé¡¹ç›®çš„å¯åŠ¨è„šæœ¬å’Œæµ‹è¯•å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹å’Œé«˜æ•ˆå¼€å‘ã€‚

### æ ¸å¿ƒè„šæœ¬

1. **`start_all_service.sh`** - ä¸»å¯åŠ¨è„šæœ¬
2. **`test_api.sh`** - APIæµ‹è¯•è„šæœ¬
3. **`start_all_external_services.sh`** - å¤–éƒ¨æœåŠ¡ç®¡ç†è„šæœ¬

## å¯åŠ¨è„šæœ¬è¯¦è§£

### 1. ä¸»å¯åŠ¨è„šæœ¬ (`start_all_service.sh`)

#### åŸºæœ¬ç”¨æ³•

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/paulo/IdeaProjects/20250707_MCP/spring-ai-alibaba/spring-ai-alibaba-nl2sql

# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x script/start_all_service.sh

# æŸ¥çœ‹å¸®åŠ©
./script/start_all_service.sh help
```

#### å‘½ä»¤è¯¦è§£

| å‘½ä»¤ | åŠŸèƒ½æè¿° | ä½¿ç”¨åœºæ™¯ | æ‰§è¡Œæ—¶é—´ |
|------|----------|----------|----------|
| `start` | æ™ºèƒ½å¯åŠ¨æ‰€æœ‰æœåŠ¡ | é¦–æ¬¡å¯åŠ¨ã€å®Œæ•´å¯åŠ¨ | 2-3åˆ†é’Ÿ |
| `restart` | é‡å¯æ‰€æœ‰æœåŠ¡ | å¤–éƒ¨æœåŠ¡å¼‚å¸¸æ—¶ | 3-4åˆ†é’Ÿ |
| `quick` | å¿«é€Ÿé‡å¯Spring Boot | ä»£ç ä¿®æ”¹å | 30-60ç§’ |
| `rebuild` | å¼ºåˆ¶é‡æ–°ç¼–è¯‘ | ç¼–è¯‘é—®é¢˜æ—¶ | 1-2åˆ†é’Ÿ |
| `stop` | åœæ­¢Spring Bootåº”ç”¨ | åœæ­¢æœåŠ¡ | 5-10ç§’ |
| `status` | æ£€æŸ¥æœåŠ¡çŠ¶æ€ | çŠ¶æ€æ£€æŸ¥ | 5-10ç§’ |

#### è¯¦ç»†æ­¥éª¤è¯´æ˜

##### 1.1 é¦–æ¬¡å¯åŠ¨ (`start`)

```bash
./script/start_all_service.sh start
```

**æ‰§è¡Œæµç¨‹**:
1. âœ… åˆ›å»ºå¿…è¦ç›®å½• (`logs/`)
2. âœ… æ£€æŸ¥Javaç¯å¢ƒ (Zulu JDK 17)
3. âœ… æ™ºèƒ½å¯åŠ¨å¤–éƒ¨æœåŠ¡ (è·³è¿‡å·²è¿è¡Œçš„)
   - MySQLæ•°æ®åº“ (ç«¯å£3306)
   - Qdrantå‘é‡åº“ (ç«¯å£6333)
   - LM Studio LLMæœåŠ¡ (ç«¯å£1234)
4. âœ… æ™ºèƒ½Mavenç¼–è¯‘
   - æ£€æŸ¥chatæ¨¡å—æ˜¯å¦éœ€è¦ç¼–è¯‘
   - æ£€æŸ¥managementæ¨¡å—æ˜¯å¦éœ€è¦ç¼–è¯‘
   - åº”ç”¨ä»£ç æ ¼å¼åŒ–
5. âœ… å¯åŠ¨Spring Bootåº”ç”¨ (ç«¯å£8065)
6. âœ… éªŒè¯æœåŠ¡å¯ç”¨æ€§
7. âœ… æ˜¾ç¤ºæœåŠ¡ä¿¡æ¯

##### 1.2 å¿«é€Ÿé‡å¯ (`quick`) - å¼€å‘å¸¸ç”¨

```bash
./script/start_all_service.sh quick
```

**æ‰§è¡Œæµç¨‹**:
1. âœ… éªŒè¯å¤–éƒ¨æœåŠ¡çŠ¶æ€
2. âœ… åœæ­¢Spring Bootåº”ç”¨
3. âœ… å¢é‡ç¼–è¯‘ (ä»…ç¼–è¯‘æœ‰å˜æ›´çš„æ¨¡å—)
4. âœ… å¯åŠ¨Spring Bootåº”ç”¨
5. âœ… æ˜¾ç¤ºæœåŠ¡ä¿¡æ¯

**ä¼˜åŠ¿**:
- ğŸš€ è·³è¿‡å¤–éƒ¨æœåŠ¡æ£€æŸ¥ (èŠ‚çœæ—¶é—´)
- ğŸš€ å¢é‡ç¼–è¯‘ (åªç¼–è¯‘å˜æ›´çš„ä»£ç )
- ğŸš€ å¿«é€Ÿåé¦ˆ (30-60ç§’å®Œæˆ)

##### 1.3 å¼ºåˆ¶é‡ç¼–è¯‘ (`rebuild`)

```bash
./script/start_all_service.sh rebuild
```

**ä½¿ç”¨åœºæ™¯**:
- ç¼–è¯‘ç¼“å­˜é—®é¢˜
- ä¾èµ–ç‰ˆæœ¬å†²çª
- æ¸…ç†ç¼–è¯‘äº§ç‰©

### 2. æ™ºèƒ½ç¼–è¯‘ç‰¹æ€§

#### 2.1 å¢é‡ç¼–è¯‘é€»è¾‘

```bash
# æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°ç¼–è¯‘
needs_rebuild() {
    # 1. æ£€æŸ¥targetç›®å½•æ˜¯å¦å­˜åœ¨
    # 2. æ£€æŸ¥Javaæºç æ˜¯å¦æœ‰æ›´æ–°
    # 3. æ£€æŸ¥pom.xmlæ˜¯å¦æœ‰å˜æ›´
}
```

#### 2.2 æ¨¡å—ä¾èµ–ç®¡ç†

```mermaid
flowchart LR
    A[chatæ¨¡å—] --> B[installåˆ°æœ¬åœ°ä»“åº“]
    B --> C[managementæ¨¡å—]
    C --> D[ç¼–è¯‘å®Œæˆ]
    
    style A fill:#10b981,stroke:#ffffff,stroke-width:3px,color:#ffffff
    style B fill:#eab308,stroke:#ffffff,stroke-width:3px,color:#ffffff
    style C fill:#3b82f6,stroke:#ffffff,stroke-width:3px,color:#ffffff
```

**ç¼–è¯‘é¡ºåº**:
1. **chatæ¨¡å—**: å…ˆç¼–è¯‘å¹¶å®‰è£…åˆ°æœ¬åœ°Mavenä»“åº“
2. **managementæ¨¡å—**: ä¾èµ–chatæ¨¡å—ï¼Œåç¼–è¯‘

## æµ‹è¯•è„šæœ¬ä½¿ç”¨

### 1. APIæµ‹è¯•è„šæœ¬ (`test_api.sh`)

#### åŸºæœ¬ç”¨æ³•

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x script/test_api.sh

# è¿è¡Œé¢„å®šä¹‰æµ‹è¯•ç”¨ä¾‹
./script/test_api.sh test

# äº¤äº’å¼æµ‹è¯•
./script/test_api.sh interactive

# æ€§èƒ½æµ‹è¯•
./script/test_api.sh performance

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./script/test_api.sh check
```

#### æµ‹è¯•ç”¨ä¾‹è¯¦è§£

##### 1.1 é¢„å®šä¹‰æµ‹è¯•ç”¨ä¾‹ (`test`)

```bash
./script/test_api.sh test
```

**æµ‹è¯•å†…å®¹**:
1. **è´§å¸å’ŒåŸºé‡‘ç±»å‹æŸ¥è¯¢**: "æŸ¥è¯¢æ¸¯å¸åŸºé‡‘"
   - éªŒè¯è¡¨åæ˜ å°„: `funds` â†’ `B_UT_PROD`
   - éªŒè¯å­—æ®µæ˜ å°„: `currency` â†’ `CCY_PROD_TRADE_CDE`

2. **ç¾å…ƒè´§å¸æŸ¥è¯¢**: "æŸ¥æ‰¾ç¾å…ƒäº§å“"
   - éªŒè¯è´§å¸ä»£ç æ˜ å°„: USD

3. **åŸºç¡€æŸ¥è¯¢**: "æ˜¾ç¤ºæ‰€æœ‰åŸºé‡‘ä¿¡æ¯"
   - éªŒè¯åŸºæœ¬SQLç”Ÿæˆ

4. **é£é™©ç­‰çº§æŸ¥è¯¢**: "æŸ¥è¯¢é«˜é£é™©åŸºé‡‘"
   - éªŒè¯é£é™©ç­‰çº§å­—æ®µæ˜ å°„

5. **æ•°å€¼æ¡ä»¶æŸ¥è¯¢**: "æ‰¾å‡ºæ”¶ç›Šç‡å¤§äº5%çš„äº§å“"
   - éªŒè¯æ•°å€¼æ¡ä»¶å¤„ç†

**é¢„æœŸè¾“å‡ºç¤ºä¾‹**:
```
[SUCCESS] âœ… è¯­ä¹‰æ˜ å°„: è¡¨åæ˜ å°„æ­£å¸¸ (funds â†’ B_UT_PROD)
[SUCCESS] âœ… è¯­ä¹‰æ˜ å°„: å­—æ®µåæ˜ å°„æ­£å¸¸ (currency â†’ CCY_PROD_TRADE_CDE)
[INFO] æˆåŠŸ: 5/5
[SUCCESS] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼
```

##### 1.2 äº¤äº’å¼æµ‹è¯• (`interactive`)

```bash
./script/test_api.sh interactive
```

**ä½¿ç”¨æ–¹æ³•**:
```
è¯·è¾“å…¥æŸ¥è¯¢ > æŸ¥è¯¢äººæ°‘å¸åŸºé‡‘
è¯·è¾“å…¥æŸ¥è¯¢ > æ‰¾å‡ºä½é£é™©äº§å“
è¯·è¾“å…¥æŸ¥è¯¢ > quit  # é€€å‡º
```

##### 1.3 æ€§èƒ½æµ‹è¯• (`performance`)

```bash
./script/test_api.sh performance
```

**æµ‹è¯•å†…å®¹**:
- æ‰§è¡Œ5æ¬¡ç›¸åŒæŸ¥è¯¢
- è®¡ç®—å¹³å‡å“åº”æ—¶é—´
- è¯„ä¼°ç³»ç»Ÿæ€§èƒ½

## å¼€å‘å·¥ä½œæµ

### 1. æ—¥å¸¸å¼€å‘æµç¨‹

```mermaid
flowchart TD
    A[ä¿®æ”¹ä»£ç ] --> B[å¿«é€Ÿé‡å¯]
    B --> C[è¿è¡Œæµ‹è¯•]
    C --> D{æµ‹è¯•é€šè¿‡?}
    D -->|æ˜¯| E[ç»§ç»­å¼€å‘]
    D -->|å¦| F[æ£€æŸ¥æ—¥å¿—]
    F --> G[ä¿®å¤é—®é¢˜]
    G --> A
    E --> A
    
    style B fill:#10b981,stroke:#ffffff,stroke-width:3px,color:#ffffff
    style C fill:#eab308,stroke:#ffffff,stroke-width:3px,color:#ffffff
    style D fill:#3b82f6,stroke:#ffffff,stroke-width:3px,color:#ffffff
```

#### æ­¥éª¤è¯¦è§£

1. **ä¿®æ”¹ä»£ç **
   ```bash
   # ç¼–è¾‘è¯­ä¹‰æ˜ å°„è§„åˆ™
   vim spring-ai-alibaba-nl2sql-chat/src/main/java/com/alibaba/cloud/ai/service/Nl2SqlService.java
   ```

2. **å¿«é€Ÿé‡å¯**
   ```bash
   ./script/start_all_service.sh quick
   ```

3. **è¿è¡Œæµ‹è¯•**
   ```bash
   ./script/test_api.sh test
   ```

4. **æ£€æŸ¥æ—¥å¿—** (å¦‚æœæµ‹è¯•å¤±è´¥)
   ```bash
   tail -f logs/nl2sql-mvp1.log
   ```

### 2. é¦–æ¬¡ç¯å¢ƒæ­å»º

```bash
# 1. é¦–æ¬¡å®Œæ•´å¯åŠ¨
./script/start_all_service.sh start

# 2. éªŒè¯æ‰€æœ‰åŠŸèƒ½
./script/test_api.sh test

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
./script/start_all_service.sh status
```

### 3. æ•…éšœæ¢å¤æµç¨‹

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
./script/start_all_service.sh status

# 2. å¦‚æœå¤–éƒ¨æœåŠ¡å¼‚å¸¸
./script/start_all_service.sh restart

# 3. å¦‚æœç¼–è¯‘é—®é¢˜
./script/start_all_service.sh rebuild

# 4. éªŒè¯ä¿®å¤ç»“æœ
./script/test_api.sh test
```

## æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1.1 ç¼–è¯‘å¤±è´¥

**é—®é¢˜**: Mavenç¼–è¯‘å¤±è´¥
```
[ERROR] Chatæ¨¡å—ç¼–è¯‘å¤±è´¥ï¼Œåœæ­¢æ„å»º
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. å¼ºåˆ¶é‡æ–°ç¼–è¯‘
./script/start_all_service.sh rebuild

# 2. æ£€æŸ¥Javaç¯å¢ƒ
java -version

# 3. æ¸…ç†Mavenç¼“å­˜
rm -rf ~/.m2/repository/com/alibaba/cloud/ai/
```

#### 1.2 ç«¯å£å ç”¨

**é—®é¢˜**: ç«¯å£8065è¢«å ç”¨
```
[WARNING] ç«¯å£8065å·²è¢«å ç”¨ï¼Œå°è¯•åœæ­¢ç°æœ‰è¿›ç¨‹...
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. åœæ­¢ç°æœ‰æœåŠ¡
./script/start_all_service.sh stop

# 2. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8065

# 3. å¼ºåˆ¶ç»ˆæ­¢è¿›ç¨‹
kill -9 $(lsof -t -i :8065)
```

#### 1.3 å¤–éƒ¨æœåŠ¡å¼‚å¸¸

**é—®é¢˜**: MySQLæˆ–QdrantæœåŠ¡å¼‚å¸¸
```
[ERROR] å¤–éƒ¨æœåŠ¡çŠ¶æ€å¼‚å¸¸
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. é‡å¯å¤–éƒ¨æœåŠ¡
./script/start_all_external_services.sh restart

# 2. æ£€æŸ¥DockerçŠ¶æ€
docker ps

# 3. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs mysql-nl2sql-mvp1
docker logs qdrant-nl2sql-mvp1
```

### 2. æ—¥å¿—åˆ†æ

#### 2.1 ä¸»è¦æ—¥å¿—æ–‡ä»¶

```bash
# Spring Bootåº”ç”¨æ—¥å¿—
tail -f logs/nl2sql-mvp1.log

# å¤–éƒ¨æœåŠ¡æ—¥å¿—
docker logs -f mysql-nl2sql-mvp1
docker logs -f qdrant-nl2sql-mvp1
```

#### 2.2 å…³é”®æ—¥å¿—æ ‡è¯†

```bash
# è¯­ä¹‰å¢å¼ºåŠŸèƒ½æ—¥å¿—
grep "ğŸ¯" logs/nl2sql-mvp1.log

# é”™è¯¯æ—¥å¿—
grep "ERROR" logs/nl2sql-mvp1.log

# SQLç”Ÿæˆæ—¥å¿—
grep "Enhanced SQL" logs/nl2sql-mvp1.log
```

## æœ€ä½³å®è·µ

### 1. å¼€å‘å»ºè®®

1. **ä½¿ç”¨å¿«é€Ÿé‡å¯**: ä»£ç ä¿®æ”¹åä½¿ç”¨ `quick` å‘½ä»¤
2. **å®šæœŸæµ‹è¯•**: æ¯æ¬¡ä¿®æ”¹åè¿è¡Œæµ‹è¯•ç”¨ä¾‹
3. **ç›‘æ§æ—¥å¿—**: ä¿æŒæ—¥å¿—çª—å£å¼€å¯
4. **ç‰ˆæœ¬æ§åˆ¶**: é‡è¦ä¿®æ”¹å‰å¤‡ä»½ä»£ç 

### 2. æ€§èƒ½ä¼˜åŒ–

1. **å¢é‡ç¼–è¯‘**: åˆ©ç”¨æ™ºèƒ½ç¼–è¯‘ç‰¹æ€§
2. **æœåŠ¡å¤ç”¨**: é¿å…é¢‘ç¹é‡å¯å¤–éƒ¨æœåŠ¡
3. **ç¼“å­˜åˆ©ç”¨**: ä¿æŒMavenæœ¬åœ°ä»“åº“

### 3. å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ç«¯å£ç®¡ç†**: ç¡®ä¿ç«¯å£ä¸å†²çª
2. **è¿›ç¨‹æ¸…ç†**: åŠæ—¶æ¸…ç†åƒµå°¸è¿›ç¨‹
3. **èµ„æºç›‘æ§**: ç›‘æ§å†…å­˜å’ŒCPUä½¿ç”¨

## æ€»ç»“

é€šè¿‡è¿™å¥—å®Œæ•´çš„å¯åŠ¨è„šæœ¬å’Œæµ‹è¯•å·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥ï¼š

- ğŸš€ **å¿«é€Ÿå¯åŠ¨**: 30ç§’å†…å®Œæˆä»£ç ä¿®æ”¹åçš„é‡å¯
- ğŸ”§ **æ™ºèƒ½ç¼–è¯‘**: è‡ªåŠ¨æ£€æµ‹å˜æ›´ï¼Œåªç¼–è¯‘å¿…è¦çš„æ¨¡å—
- ğŸ“Š **è‡ªåŠ¨æµ‹è¯•**: ä¸€é”®éªŒè¯è¯­ä¹‰å¢å¼ºåŠŸèƒ½
- ğŸ› ï¸ **æ•…éšœè¯Šæ–­**: å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜

è¿™å¤§å¹…æå‡äº†å¼€å‘æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒï¼
